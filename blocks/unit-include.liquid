<div id="variantAdditionalInfoWrapper-{{ section.id }}">
  {%- assign init_variant = product.selected_or_first_available_variant -%}
  {%- if init_variant != blank -%}
    <div id="variantAdditionalInfo-{{ section.id }}">
      Calculating...
    </div>
  {%- endif -%}
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const quantitySelectors = document.querySelectorAll(".quantity-selector");
  const unitValueElement = document.getElementById("variantAdditionalInfo-{{ section.id }}");

  // Get initial value from Liquid as a number (fallback 0 if no metafield value)
  const unitBaseValue = Number({{ init_variant.metafields.custom.unit_include | default: 0 }});

  if (!quantitySelectors.length || !unitValueElement) return;

  quantitySelectors.forEach(selector => {
    const quantityInput = selector.querySelector("input[name='quantity']");
    const minusBtn = selector.querySelector("button[name='minus']");
    const plusBtn = selector.querySelector("button[name='plus']");

    if (!quantityInput) return;

    function updateUnitInfo() {
      const quantity = Number(quantityInput.value) || 1;
      const total = unitBaseValue * quantity;
      unitValueElement.textContent = total; // Replace "Calculating..." with result
      console.log(`Quantity: ${quantity}, Unit Value: ${unitBaseValue}, Total: ${total}`);
    }

    // Attach event listeners
    if (minusBtn) minusBtn.addEventListener("click", updateUnitInfo);
    if (plusBtn) plusBtn.addEventListener("click", updateUnitInfo);
    quantityInput.addEventListener("input", updateUnitInfo);

    // Run once on page load to replace "Calculating..."
    updateUnitInfo();
  });
});
</script>

{% schema %}
{
  "name": "Unit Include",
  "settings": [],
  "presets": [
    {
      "category": "Custom Block",
      "name": "Unit Include"
    }
  ]
}
{% endschema %}
